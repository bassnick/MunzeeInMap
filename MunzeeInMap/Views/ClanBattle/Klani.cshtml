@using MunzeeInMap.MunzeeAppObjects
@model System.Collections.Generic.List<MunzeeInMap.MunzeeAppObjects.Clan1703>

@{
    ViewBag.Title = "Klání 17/03";
}
<br />
@Html.RouteLink("Autorizace pro GPX data pro GeoGet", "Autorizace")
<br/>
<strong>Data z oficiálních klanových statistik MHQ. Aktualizováno jednou denně se začátkem munzee dne (tj. půlnoc Texaského času). U nás ráno v 7:00</strong>
<br/>
@if (DateTime.Now > new DateTime(2017, 4, 3, 6, 59, 59))
{
    <div>Funkcionalita pro aktuální klání nebyla ještě naprogramována.</div>
}
else
{
    foreach (var klan in Model)
    {
        Level1703 levelRequirements = new Level1703();

        if (klan.DetailScore.finalLevel == 0)
        {
            continue;
        }
        Requirements1703 req = levelRequirements.level[klan.DetailScore.finalLevel];

        <article>
            <table class="klan">
                <thead>
                <tr class="popis"><td colspan="5">Klání 17/03 - @klan.ClanName - cíl: level @klan.DetailScore.finalLevel.ToString()</td></tr>
                <tr><th>Hráč</th><th>Počet deploys zelených</th><th>Počet odlovů zelených</th><th>Počet odlovů čtyřlístků</th><th>Celkem bodů</th></tr>
                </thead>
                <tbody>
                @{
                    int bodovaniHraci = klan.DetailScore.playerOrder.Count;
                    int clanPoints = 0;
                    int clanNCG = 0;
                    int clanNCS = 0;



                }
                @for (int poradi = 0; poradi < bodovaniHraci; poradi++)
                {

                    Battle1703 battle = @klan.DetailScore;
                    string player = @battle.playerOrder[poradi + 1];
                    //int tot = (battle.total_points.ContainsKey(player)) ? battle.total_points[player] : 0;
                    int ndg = (battle.number_deps_green.ContainsKey(player)) ? battle.number_deps_green[player] : 0;
                    int ncg = (battle.number_caps_green.ContainsKey(player)) ? battle.number_caps_green[player] : 0;
                    int ncs = (battle.number_caps_shamrock.ContainsKey(player)) ? battle.number_caps_shamrock[player] : 0;

                    int pts = (battle.total_points.ContainsKey(player)) ? battle.total_points[player] : 0;

                    //bool donePlayer = (rest >= 0 && restDeps >= 0);

                    clanPoints += pts;
                    clanNCG += ncg;
                    clanNCS += ncs;


                    int restDGreen = ndg - req.PlayerGreenieDeploys;
                    int restPts = pts - req.PlayerPoints;


                    string printOK = ":)";
                    <tr>
                        <td><strong>@player</strong></td>
                        <td>@ndg
                            @if (restDGreen >= 0)
                            {
                                <img class="fajfka" alt=":)" src="~/Content/zelena_fajfka-2.png"/>
                            }
                            else
                            {
                                <span>(<strong>@restDGreen</strong>)</span>
                            }
                        </td>
                        <td>
                            @ncg
                            <img class="fajfka" alt=":)" src="~/Content/zelena_fajfka-2.png"/>
                            @if (req.ClanGreenieCaptures != 0)
                            {
                                <span>
                                (@((1000*ncg)/req.ClanGreenieCaptures)%;
                                @if (ncg < req.ClanGreenieCaptures/10)
                                {
                                    <span>@(ncg - (req.ClanGreenieCaptures/10))</span>
                                }
                                )
                            </span>
                            }
                        </td>
                        <td>
                            @ncs
                            <img class="fajfka" alt=":)" src="~/Content/zelena_fajfka-2.png" />
                            @if (req.ClanShamrockCaptures != 0)
                            {
                                <span>
                                    (@((1000 * ncs) / req.ClanShamrockCaptures)%;
                                    @if (ncs < req.ClanShamrockCaptures / 10)
                                    {
                                        <span>@(ncs - (req.ClanShamrockCaptures / 10))</span>
                                    }
                                    )
                                </span>
                            }
                        </td>
                        <td>
                            @pts
                            @if (restPts >= 0)
                            {
                                <img class="fajfka" alt=":)" src="~/Content/zelena_fajfka-2.png" />
                                if (req.ClanTotalPoints != 0)
                                {
                                    <span>
                                        (@((1000 * pts) / req.ClanTotalPoints)%;
                                        @if (pts < req.ClanTotalPoints / 10)
                                        {
                                            <span>@(pts - (req.ClanTotalPoints/ 10))</span>
                                        }
                                        )
                                    </span>
                                }
                            }
                            else
                            {
                                <span>(<strong>@restPts</strong>)</span>
                            }

                        </td>
                    </tr>
                }
                </tbody>
                <tfoot>
                @{
                    int restClanPts = clanPoints - req.ClanTotalPoints;
                    int restClanShamrocks = clanNCS - req.ClanShamrockCaptures;
                    int restClanGreenies = clanNCG - req.ClanGreenieCaptures;
                    bool doneClan1 = restClanGreenies >= 0;
                    bool doneClan2 = restClanShamrocks >= 0;
                    bool doneClan3 = restClanPts >= 0;

                    //bool done = doneClan1 && doneClan2 && doneClan3;
                }
                <tr class="popis">
                    <td></td>
                    <td></td>
                    <td>@clanNCG.ToString()
                    @if (doneClan1)
                    {
                        <img class="fajfka" alt=":)" src="~/Content/zelena_fajfka-2.png" />
                    }
                    else
                    {
                        <span><strong>(@restClanGreenies)</strong></span>
                    }</td>
                    <td>@clanNCS.ToString()
                    @if (doneClan2)
                    {
                        <img class="fajfka" alt=":)" src="~/Content/zelena_fajfka-2.png" />
                    }
                    else
                    {
                        <span><strong>(@restClanShamrocks)</strong></span>
                    }</td>
                    <td>
                        @clanPoints.ToString()
                        @if (doneClan3)
                        {
                            <img class="fajfka" alt=":)" src="~/Content/zelena_fajfka-2.png"/>
                        }
                        else
                        {
                            <span><strong>(@restClanPts)</strong></span>
                        }
                    </td>
                </tr>
                </tfoot>
            </table>
        </article>
    }
}