@using MunzeeInMap.MunzeeAppObjects
@model System.Collections.Generic.List<MunzeeInMap.MunzeeAppObjects.NewClan1704>

@{
    ViewBag.Title = "Klání 17/04";
}
<br />
@Html.RouteLink("Autorizace pro GPX data pro GeoGet", "Autorizace")
<br/>
<strong>Data z oficiálních klanových statistik MHQ. @*Aktualizováno jednou denně se začátkem munzee dne (tj. půlnoc Texaského času). U nás ráno v 7:00*@</strong>
<br/>
@if (DateTime.Now > new DateTime(2017, 5, 3, 6, 59, 59))
{
    <div>Funkcionalita pro aktuální klání nebyla ještě naprogramována.</div>
}
else
{
    foreach (var klan in Model)
    {
        Level1704 levelRequirements = new Level1704();

        if (klan.DetailScore.finalLevel == 0)
        {
            continue;
        }
        Requirements1704 req = levelRequirements.level[klan.DetailScore.finalLevel];

        <article>
            <table class="klan">
                <thead>
                <tr class="popis"><td colspan="3">Klání 17/04 - @klan.ClanName - cíl: level @klan.DetailScore.finalLevel.ToString()</td></tr>
                <tr><th>Hráč</th><th>Capture bodů</th><th>Celkově bodů</th></tr>
                </thead>
                <tbody>
                @{
                    int clanTot = 0;
                    int clanCaps = 0;
                }
                @for (int poradi = 0; poradi < 10; poradi++)
                {

                    NewBattle1704 battle = @klan.DetailScore;
                    string player = @battle.sorted_total_points[poradi].Key;
                    int tot = battle.sorted_total_points[poradi].Value;
                    int caps = battle.caps_points[player];

                    bool donePlayerCaps = caps >= req.PlayerCapturePoints;
                    bool donePlayerTot = tot >= req.PlayerTotalPoints;
                    int restPlayerCaps = req.PlayerCapturePoints - caps;
                    int restPlayerTot = req.PlayerTotalPoints - tot;
                    int percentagePlayerCaps = (caps*100*10)/req.ClanCapturePoints;
                    int percentagePlayerTot = (tot * 100 * 10) / req.ClanTotalPoints;

                    int restOptimumPlayerCaps = req.ClanCapturePoints / 10 - caps;
                    int restOptimumPlayerTot = req.ClanTotalPoints / 10 - tot;



                    clanTot += tot;
                    clanCaps += caps;

                    string printOK = ":)";
                    <tr>
                        <td><strong>@player</strong></td>
                        <td>@caps
                            @if (donePlayerCaps)
                            {
                                <img class="fajfka" alt=":)" src="~/Content/zelena_fajfka-2.png"/>
                            }
                            else
                            {
                                <span>(<strong>@(-restPlayerCaps)</strong>)</span>
                            }
                            <span>
                                (@percentagePlayerCaps%;
                                @if (percentagePlayerCaps < 100)
                                {
                                    <span>@(-restOptimumPlayerCaps)</span>
                                }
                                )
                            </span>
                        </td>
                        <td>
                            @tot
                            @if (donePlayerTot)
                            {
                                <img class="fajfka" alt=":)" src="~/Content/zelena_fajfka-2.png"/>
                            }
                            else
                            {
                                <span>(<strong>@(-restPlayerTot)</strong>)</span>
                            } 
                            <span>
                                (@percentagePlayerTot%;
                                @if (percentagePlayerTot < 100)
                                {
                                    <span>@(-restOptimumPlayerTot)</span>
                                }
                                )
                            </span>
                        </td>
                    </tr>
                }
                </tbody>
                <tfoot>
                @{
                    bool doneClanCaps = clanCaps >= req.ClanCapturePoints;
                    bool doneClanTots = clanTot >= req.ClanTotalPoints;
                    int restClanCaps = req.ClanCapturePoints - clanCaps;
                    int restClanTots = req.ClanTotalPoints - clanTot;
                }
                <tr class="popis">
                    <td></td>
                    <td>@clanCaps.ToString()
                        @if (doneClanCaps)
                        {
                            <img class="fajfka" alt=":)" src="~/Content/zelena_fajfka-2.png"/>
                        }
                        else
                        {
                            <span><strong>(@(-restClanCaps))</strong></span>
                        }</td>
                    <td>
                        @clanTot.ToString()
                    @if (doneClanTots)
                    {
                        <img class="fajfka" alt=":)" src="~/Content/zelena_fajfka-2.png" />
                    }
                    else
                    {
                        <span><strong>(@(-restClanTots))</strong></span>
                    }
                </td>
                </tr>
                </tfoot>
            </table>
        </article>
    }
}