@using MunzeeInMap.MunzeeAppObjects
@model System.Collections.Generic.List<MunzeeInMap.MunzeeAppObjects.Clan1604>

@{
    ViewBag.Title = "Klání 16/04";
}
<br />
@Html.RouteLink("Autorizace pro GPX data pro GeoGet", "Autorizace")
<br/>
<strong>Data z oficiálních klanových statistik MHQ. Aktualizováno jednou denně se začátkem munzee dne (tj. půlnoc Texaského času). U nás ráno v 7:00</strong>
<br/>

@foreach (var klan in Model)
{
    int totalPoint = 0;
    int capturesGreeniesNFC = 0;
    int specialPoints = 0;
    int deployesNum = 0;
    
    Level1604 levelRequirements = new Level1604();

    if (klan.DetailScore.finalLevel == 0)
    { continue; }
    Requirements1604 req = levelRequirements.level[klan.DetailScore.finalLevel];
                
    <article>
        <table class="klan">
            <thead>
                <tr class="popis"><td colspan="5">Klání 16/04 - @klan.ClanName - cíl: level @klan.DetailScore.finalLevel.ToString()</td></tr>
            <tr><th>Hráč</th>@*<th>Deploy body</th><th>Capture body</th><th>Capture On body</th>*@<th>Bodů</th><th>Počet zelených a nfc</th><th>Body za odlovy speciálek</th><th>Počet deploy</th></tr>
            </thead>
            <tbody>
            @{ int bodovaniHraci = klan.DetailScore.playerOrder.Count; }
            @for (int poradi = 0; poradi < bodovaniHraci; poradi++)
            {

                Battle1604 battle = @klan.DetailScore;
                string player = @battle.playerOrder[poradi + 1];
                int tot = (battle.total_points.ContainsKey(player)) ? battle.total_points[player] : 0;
                totalPoint += tot;
                int greenieNFCCap = (battle.total_greenies_and_nfc_captures.ContainsKey(player)) ? battle.total_greenies_and_nfc_captures[player] : 0;
                capturesGreeniesNFC += greenieNFCCap;
                int specPts = (battle.specials_cap_points.ContainsKey(player)) ? battle.specials_cap_points[player] : 0;
                specialPoints +=specPts;
                int deps = (battle.number_deployed.ContainsKey(player)) ? battle.number_deployed[player] : 0;
                deployesNum += deps;
                

                int rest = tot - req.PlayerPoints;
                bool donePlayer = rest >= 0;

                string printOK = ":)";
                <tr>
                    <td><strong>@player</strong></td>
@*                    <td>@dep</td>*@
@*                    <td>@cap</td>*@
@*                    <td>@con</td>*@
                    <td>@tot @if (donePlayer)
                    {
                        <img class="fajfka" alt=":)" src="~/Content/zelena_fajfka-2.png" />
                    }
                    else
                    {
                        <span>(<strong>@rest</strong>)</span>
                    }
                    <span> (@((1000 * tot) / req.ClanPoints)%;@if (tot < req.ClanPoints / 10)
                            {
                                <span>@(tot - (req.ClanPoints / 10))</span>
                            })</span>    
                    </td>
                    <td>
                        @greenieNFCCap
                        <span>
                            (@((1000 * greenieNFCCap) / req.ClanGreenieAndNfcCaptures)%;@if (greenieNFCCap < req.ClanGreenieAndNfcCaptures / 10)
                            {
                                <span>@(greenieNFCCap - req.ClanGreenieAndNfcCaptures / 10)</span>
                            })
                        </span>
                    <td>
                        @specPts
                        <span>
                            (@((1000*specPts)/req.ClanSpecialsCapPts)%;@if (specPts < req.ClanSpecialsCapPts/10)
                                                                 {
                                                                     <span>@(specPts - req.ClanSpecialsCapPts/10)</span>
                                                                 })
                        </span>
                    </td>
                    </td>
                    <td>
                        @deps
                        <span>
                            (@((1000 * deps) / req.ClanDeploys)%;@if (deps < req.ClanDeploys / 10)
                            {
                                <span>@(deps - req.ClanDeploys / 10)</span>
                            })
                        </span>
                    </td>




                    

                </tr>
            }
            </tbody>
            <tfoot>
            @{
                int restClanPoints = totalPoint - req.ClanPoints;
                bool doneClan1 = restClanPoints >= 0;
            }
            <tr class="popis">
                <td></td>
                <td>@totalPoint.ToString()
                    @if (doneClan1)
                    {
                        <img class="fajfka" alt=":)" src="~/Content/zelena_fajfka-2.png"/>
                    }
                    else
                    {
                        <span><strong>(@restClanPoints)</strong></span>
                    }</td>
            
                @{
                    int restCap= capturesGreeniesNFC - req.ClanGreenieAndNfcCaptures;
                    bool doneClan2 = restCap >= 0;
                }
                <td>
                    @capturesGreeniesNFC.ToString()
                    @if (doneClan2)
                    {
                        <img class="fajfka" alt=":)" src="~/Content/zelena_fajfka-2.png"/>
                    }
                    else
                    {
                        <span><strong>(@restCap)</strong></span>
                    }
                </td>
                <td>
                    @{
                    int restMH = specialPoints - req.ClanSpecialsCapPts;
                    bool doneClan3 = restMH >= 0;
                    }
                    @specialPoints.ToString()
                    @if (doneClan3)
                    {
                        <img class="fajfka" alt=":)" src="~/Content/zelena_fajfka-2.png" />
                    }
                    else
                    {
                        <span><strong>(@restMH)</strong></span>
                    }
                </td>            @**@
@{
                    int restD = deployesNum - req.ClanDeploys;
                    bool doneClan4 = restD >= 0;
}
                <td>
                    @deployesNum.ToString()
                    @if (doneClan4)
                    {
                        <img class="fajfka" alt=":)" src="~/Content/zelena_fajfka-2.png"/>
                    }
                    else
                    {
                        <span><strong>(@restD)</strong></span>
                    }
                </td>
                
                </tr>
            </tfoot>
        </table>
    </article>
}
